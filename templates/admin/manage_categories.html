{% extends "admin/admin_base.html" %}

{% block admin_title %}Manage Categories{% endblock %}

{% block admin_content %}
<h1>Manage Categories</h1>
<p class="tool-subtitle">Organize your blog posts into categories.</p>

<div class="admin-section-grid" style="grid-template-columns: 1fr 2fr; align-items: flex-start;">
    <!-- Add/Edit Form -->
    <div class="admin-main-panel">
        <h2 class="admin-panel-title" id="category-form-title">Add New Category</h2>
        <form id="category-form" method="POST" action="{{ url_for('manage_categories') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="category_id" id="category_id">
            <div style="margin-bottom: 20px;">
                <label for="name" style="font-weight: 700; display: block; margin-bottom: 10px;">Category Name</label>
                <input type="text" name="name" id="category_name" class="auth-input" required>
            </div>
            <button type="submit" class="btn btn-primary">Save Category</button>
            <button type="button" id="cancel-edit-btn" class="btn btn-secondary hidden">Cancel</button>
        </form>
    </div>

    <!-- Category List -->
    <div class="admin-table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Slug</th>
                    <th>Post Count</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for category in categories %}
                <tr>
                    <td>{{ category.name }}</td>
                    <td>{{ category.slug }}</td>
                    <td>{{ category.posts.count() }}</td>
                    <td>
                        <button class="btn btn-secondary edit-btn" data-id="{{ category.id }}" data-name="{{ category.name }}">Edit</button>
                        <form action="{{ url_for('delete_category', category_id=category.id) }}" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure?');">
                             <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                             <button type="submit" class="btn btn-secondary" style="background-color: #8C1C1B; color: white;">Delete</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="4" style="text-align: center; padding: 20px;">No categories found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('category-form');
    const formTitle = document.getElementById('category-form-title');
    const catIdInput = document.getElementById('category_id');
    const catNameInput = document.getElementById('category_name');
    const cancelBtn = document.getElementById('cancel-edit-btn');

    document.querySelectorAll('.edit-btn').forEach(button => {
        button.addEventListener('click', function() {
            catIdInput.value = this.dataset.id;
            catNameInput.value = this.dataset.name;
            formTitle.textContent = 'Edit Category';
            cancelBtn.classList.remove('hidden');
            catNameInput.focus();
        });
    });

    cancelBtn.addEventListener('click', function() {
        form.reset();
        catIdInput.value = '';
        formTitle.textContent = 'Add New Category';
        this.classList.add('hidden');
    });
});
</script>
{% endblock %}